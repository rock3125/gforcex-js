<!DOCTYPE html>
<html>
<head>
    <title>G-Force X</title>
    <script type="text/javascript" src="cookie.js"></script>
    <script type="text/javascript" src="const.js"></script>
    <script type="text/javascript" src="sound.js"></script>
    <script type="text/javascript" src="map.js"></script>
    <script type="text/javascript" src="ship.js"></script>
    <script type="text/javascript" src="turret.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; color: #0f0; font-family: 'Courier New', monospace; }
        canvas { display: block; }
        .controls-legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #0f0;
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border: 1px solid #333;
            border-radius: 4px;
            pointer-events: none;
            font-size: 14px;
            line-height: 1.6;
        }
        .key {
            display: inline-block;
            border: 1px solid #0f0;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 20px;
            margin: 0 2px;
            background: #020;
            min-width: 15px;
            text-align: center;
            font-weight: bold;
        }
        .control-item {
            margin-bottom: 5px;
        }
        .hud { position: absolute; top: 20px; left: 20px; text-shadow: 2px 2px #000; pointer-events: none; }
        #minimap { position: absolute; bottom: 20px; right: 20px; border: 2px solid #555; background: rgba(0,0,0,0.8); }
    </style>
</head>
<body>
<div class="hud">
    ROCK'S G-FORCE X<br/><br/>
    FUEL:<br/>
    AMMO:<br/>
</div>
<div class="controls-legend">
    <div class="control-item"><span class="key">&#8592;</span> <span class="key">&#8594;</span> Rotate</div>
    <div class="control-item"><span class="key">&#8595;</span> Thrust</div>
    <div class="control-item"><span class="key">Space</span> Fire</div>
    <div class="control-item"><span class="key">M</span> <span id="music"></span></div>
</div>
<canvas id="gameCanvas"></canvas>
<canvas id="minimap" width="150" height="150"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const mCanvas = document.getElementById('minimap');
    const mCtx = mCanvas.getContext('2d');
    const text_display_ctrl = document.getElementById("music");

    // keyboard map (key: string -> boolean)
    let keys = {};
    let gameOver = false;
    const ship = new Ship();
    const map = new Map();

    function triggerGameOver() {
        if (gameOver) return;
        gameOver = true;

        // Launch the particles at the ship's current location
        ship.createExplosion();

        setTimeout(() => {
            gameOver = false;
            ship.reset(map);
        }, 1500);
    }

    function update() {
        ship.update(map);
        sound_check_keys();
    }

    function draw() {
        map.draw(ship);
    }

    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    });
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;

    // set text
    set_cookie("title_music", music_on ? "on" : "off", 7, document.getElementById("music"));
    map.generateWorld();
    ship.reset(map);

    loop();

</script>
</body>
</html>
